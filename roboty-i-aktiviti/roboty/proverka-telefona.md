# Проверка WhatsApp на номере

{% hint style="info" %}
В настоящее время проверка номера на наличие WhatsApp осуществляется сразу при отправке сообщения. Если отправка осуществляется на номер, на котором не установлен WhatsApp, в дополнительных результатах выполнения робота или активити бизнес-процесса вы получите ошибку **«NW»** а в описании ошибки — более развёрнутое её описание: **«Ошибка при отправке: телефонный номер 7961\*\*\*\*\*57 не найден в WhatsApp»**
{% endhint %}

<figure><img src="../../.gitbook/assets/image (986).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (132).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Робот и активити **«Проверка WhatsApp на номере»** могут быть использованы в отдельных случаях, когда вы хотите явно получить результат проверки номера на наличие WhatsApp и использовать его в ваших сценариях работы. Пользоваться данным роботом и активити каждый раз при стандартной отправке нет необходимости, кроме того, они замедляют работу приложения.
{% endhint %}

{% hint style="danger" %}
Мы рекомендуем проверять на наличие WhatsApp не более 100 номеров в сутки! Делая большее количество проверок, вы делаете это на свой страх и риск! WhatsApp может заблокировать ваш номер за массовые проверки!
{% endhint %}

Робот или активити выполняют проверку и возвращают результат в виде значения **«Y»**, если WhatsApp на номере существует, или в виде значения **«N»**, если WhatsApp на номере не существует.

{% hint style="info" %}
Иногда вместо значений **«Y»** и **«N»** вы можете получить значение **«E»** - Error. Это сообщение об ошибке. Возникает оно чаще всего если проверяемый телефон недоступен. Также ошибка может возникнуть, если в робота или активити передали неверные данные: телефон как массив или несколько телефонов в поле.
{% endhint %}

{% hint style="success" %}
Результат проверки номера телефона на существование WhatsApp вы можете вывести в уведомление или записать в пользовательское поле для использования в дальнейших сценариях автоматизации.
{% endhint %}

## Настройка робота

Рассмотрим пример настройки робота с выведением результата проверки в уведомление и записью в пользовательское поле. Добавьте робота «\[OLChat — Чаты и Группы WhatsApp] WhatsApp Проверка WhatsApp на номере». Для этого перейдите в **Роботы ‒ Создать ‒ Выбор стадии ‒ Другие роботы ‒ \[OLChat] Проверить WhatsApp ‒ Добавить.**

<figure><img src="../../.gitbook/assets/image (1332).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота. Для этого на добавленном роботе нажмите на кнопку «изменить», чтобы открыть интерфейс редактирования робота. Укажите номер телефона, который хотите проверить на существование WhatsApp. Нажмите на кнопку «СОХРАНИТЬ».

![](<../../.gitbook/assets/image (1024).png>)

### Вывод результата проверки в уведомление

Выведем результат проверки в уведомление. Для этого необходимо нажать **Создать ‒ Выбор стадии ‒ Информирование сотрудников ‒ Добавить уведомление ‒ Добавить.**

<figure><img src="../../.gitbook/assets/image (510).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота.

1. Укажите, что данный робот должен сработать после предыдущего.
2. В поле «Текст сообщения» укажите результат работы робота \[OLChat] WhatsApp - Проверка WhatsApp на номере. Для этого нажмите на **троеточие — Роботы — \[OLChat — Чаты и Группы WhatsApp] WhatsApp - Проверка WhatsApp на номере — Номер существует?**\
   В поле «Текст сообщения» добавится результат выполненной проверки
3. Нажмите на кнопку «СОХРАНИТЬ».

<figure><img src="../../.gitbook/assets/Роботы проверка номера.gif" alt=""><figcaption></figcaption></figure>

### Сохранение результата проверки в пользовательское поле

Сохраним результат проверки в пользовательское поле. Для этого необходимо нажать **Создать ‒ Выбор стадии ‒ Управление элементом ‒ Изменить элемент ‒ Добавить.**

<figure><img src="../../.gitbook/assets/image (560).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота.

1. Укажите, что данный робот должен сработать после предыдущего.
2. Выберите пользовательское поле, в которое хотите записать результат работы робота \[OLChat] WhatsApp - Проверка WhatsApp на номере. Для этого нажмите на **троеточие — Роботы — \[OLChat — Чаты и Группы WhatsApp] WhatsApp - Проверка WhatsApp на номере — Номер существует?**\
   В поле добавится результат выполненной проверки.
3. Нажмите на кнопку «СОХРАНИТЬ».

<figure><img src="../../.gitbook/assets/Роботы проверка номера-2.gif" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Результат проверки робота **«\[OLChat — Чаты и Группы WhatsApp] WhatsApp - Проверка WhatsApp на номере»** возвращается спустя несколько секунд. Роботы, использующие этот результат, должны срабатывать после завершения работы робота, осуществляющего проверку WhatsApp на номере. Для этого в последующих роботах устанавливайте галочку **«после предыдущего робота»** в активное положение.
{% endhint %}

## Настройка активити (действия) бизнес-процесса

Рассмотрим пример простого бизнес-процесса с участием активити **«Проверка WhatsApp на номере».**

![](<../../.gitbook/assets/image (407).png>)

Добавьте в [действие Итератор](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=57\&LESSON_ID=10481) активити проверки номера.

Выберите и установите из дополнительных результатов Итератора номер телефона:

![](<../../.gitbook/assets/image (538).png>)

![](<../../.gitbook/assets/image (957).png>)

Для примера выведем результат проверки в виде сообщения. Для этого получим дополнительный результат из активити проверки:

![](<../../.gitbook/assets/image (710).png>)

![](<../../.gitbook/assets/image (909).png>)

В результате выполнения бизнес-процесса мы получим значение, которое можем далее проверять в условиях:

![](<../../.gitbook/assets/image (389).png>)

{% hint style="info" %}
Также, проверенные телефоны можно добавлять в отдельный тип телефона – «Для рассылки», например, и в дальнейшем отправлять сообщения на эти номера без проверки.
{% endhint %}
