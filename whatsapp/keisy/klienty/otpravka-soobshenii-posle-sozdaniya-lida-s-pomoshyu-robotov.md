# Отправка сообщений после создания лида с помощью роботов

Рассмотрим ситуацию, когда вам необходимо отправлять сообщения клиентам в разных статусах обработки лида. Если у клиента на номере есть аккаунт WhatsApp, вы можете отправить ему сообщение с помощью приложения OLChat. Если клиент в WhatsApp не зарегистрирован, можно отправить SMS.

{% hint style="warning" %}
Наш сервис не отправляет SMS-сообщения! Для отправки SMS-сообщений, на вашем портале Битрикс24 должен быть подключён провайдер SMS.
{% endhint %}

{% hint style="warning" %}
Описанные ниже последовательности роботов будут корректно работать, если в карточке лида указан только один номер телефона клиента!
{% endhint %}

&#x20;Существует несколько вариантов настроек роботов для отправки сообщений.

### 1 Нужно отправить сообщение клиенту один раз в первой стадии. Если у клиента нет WhatsApp — отправить SMS

Выполним настройку роботов для данного варианта. Сначала проверим, есть ли WhatsApp на номере клиента, а затем, отправим ему сообщение и файл. Для этого воспользуемся такими роботами: [proverka-telefona.md](../../roboty-i-aktiviti/roboty/proverka-telefona.md "mention")**,** [otpravka-soobsheniya.md](../../roboty-i-aktiviti/roboty/otpravka-soobsheniya.md "mention")**,** [otpravka-faila.md](../../roboty-i-aktiviti/roboty/otpravka-faila.md "mention")**.** Если у клиента нет WhatsApp, отправим SMS-сообщение с помощью робота **«Отправить SMS клиенту».**

Добавьте робота **«\[OLChat] Проверка WhatsApp на номере»**. Для этого перейдите в **Роботы ‒ Создать ‒ Выбор стадии ‒ Другие роботы ‒ \[OLChat] Проверка WhatsApp на номере ‒ Добавить.**

<figure><img src="../../.gitbook/assets/image (641).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота. Для этого на добавленном роботе нажмите на кнопку «изменить», чтобы открыть интерфейс редактирования робота. Укажите номер телефона, который хотите проверить на существование WhatsApp. Нажмите на кнопку «СОХРАНИТЬ».

![](<../../.gitbook/assets/image (1044).png>)

Робот выполняет проверку и возвращает результат в виде значения **«Y»**, если WhatsApp на номере существует, или в виде значения **«N»**, если WhatsApp на номере не существует. Результат проверки мы будем использовать в настройке следующего робота.

Добавьте робота **«\[OLChat] WhatsApp - Отправка сообщения».** Порядок добавления идентичен описанному выше. Выполните настройку робота.

1. Установите галочку **«после предыдущего робота»**.
2. Выполните настройку условия: в выпадающем списке выберите **Роботы — \[OLChat] WhatsApp - Проверка WhatsApp на номере — Номер существует?**, установите условие **«равно»** и в поле ниже введите значение **«Y».**

![](<../../.gitbook/assets/image (402).png>)



3\. Укажите **Линию WhatsApp**, через которую планируете сделать отправку\
4\. Введите **Номер телефона**, на который необходимо отправить сообщение\
5\. Ведите текст **Сообщения**\
6\. Нажмите на кнопку «СОХРАНИТЬ»

![](<../../.gitbook/assets/image (1030).png>)

Добавим ещё одного робота **«\[OLChat] WhatsApp - Отправка файла»,** чтобы кроме текстового сообщения клиент получил ещё и файл с предложением, прайс или картинку.

<figure><img src="../../.gitbook/assets/image (677).png" alt=""><figcaption></figcaption></figure>

Порядок настройки схож с настройкой предыдущего робота:

1. Установите галочку **«после предыдущего робота»**.
2. Выполните настройку условия: в выпадающем списке выберите **Роботы — \[OLChat] WhatsApp - Проверка WhatsApp на номере — Номер существует?**, установите условие **«равно»** и в поле ниже введите значение **«Y».**
3. Укажите **Линию WhatsApp**, через которую планируете сделать отправку
4. Введите **Номер телефона**, на который необходимо выполнить отправку
5. Укажите прямую ссылку на файл. О том, как создать прямую ссылку на файл, вы можете узнать из статьи [#sozdanie-pryamoi-ssylki-na-fail](../../roboty-i-aktiviti/sozdanie-pryamoi-ssylki-na-fail.md#sozdanie-pryamoi-ssylki-na-fail "mention").
6. Нажмите на кнопку «СОХРАНИТЬ»

![](<../../.gitbook/assets/image (383).png>)

Добавим ещё одного робота на случай, если проверка показала отсутствие у клиента аккаунта WhatsApp на номере. Отправим клиенту SMS-сообщение с помощью робота **«Отправить SMS клиенту».**

<figure><img src="../../.gitbook/assets/image (339).png" alt=""><figcaption></figcaption></figure>

Выполним настройку робота **«Отправить SMS клиенту».**

1. Установите галочку **«после предыдущего робота»**.
2. Выполните настройку условия: в выпадающем списке выберите **Роботы — \[OLChat] WhatsApp - Проверка WhatsApp на номере — Номер существует?**, установите условие **«равно»** и в поле ниже введите значение **«N».**

![](<../../.gitbook/assets/image (870).png>)

3\. Ведите **Текст сообщения**\
4\. Выберите **Тип номера клиента**\
5\. Укажите провайдера, через которого необходимо выполнить отправку\
6\. Нажмите на кнопку «СОХРАНИТЬ»

![](<../../.gitbook/assets/image (1026).png>)

### 2 Нужно отправить сообщение клиенту из нескольких стадий. Если у клиента нет WhatsApp — отправить SMS

Для того, чтобы ускорить работу роботов а также избежать повторения одних и тех же действий, рекомендуем пользоваться роботом **«\[OLChat] Проверка WhatsApp на номере»** только один раз в первой стадии. Результат проверки можно записывать в пользовательское поле, а затем, в нужных стадиях обращаться к этому полю и в зависимости от значения в нём отправлять клиенту сообщение в WhatsApp или SMS.

Выполним настройку роботов для данного варианта. Для начала создайте в лидах пользовательское поле **«Номер существует?»** и отобразите его в карточке лида.

![](<../../.gitbook/assets/image (883).png>)

![](<../../.gitbook/assets/image (805).png>)

Создайте робота **«\[OLChat] Проверка WhatsApp на номере»** в первой стадии обработки лида. Для этого перейдите в **Роботы ‒ Создать ‒ Выбор стадии ‒ Другие роботы ‒ \[OLChat] Проверка WhatsApp на номере ‒ Добавить.**

<figure><img src="../../.gitbook/assets/image (641).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота. Укажите номер телефона, который хотите проверить на существование WhatsApp. Нажмите на кнопку «СОХРАНИТЬ».

![](<../../.gitbook/assets/image (1044).png>)

Робот выполняет проверку и возвращает результат в виде значения **«Y»**, если WhatsApp на номере существует, или в виде значения **«N»**, если WhatsApp на номере не существует. Результат проверки необходимо записать в созданное выше пользовательское поле **«Номер существует?».**

Для этого необходимо добавить робота **«Изменить элемент».**

<figure><img src="../../.gitbook/assets/image (597).png" alt=""><figcaption></figcaption></figure>

Выполните настройку робота:

1. Установите галочку **«после предыдущего робота»**
2. В качестве изменяемого поля выберите поле **«Номер существует?».** В данное поле необходимо записать результат проверки, осуществлённой предыдущим роботом
3. Нажмите на кнопку «СОХРАНИТЬ»

![](<../../.gitbook/assets/image (973).png>)

В поле **«Номер существует?»** будет записан результат проверки: значение **«Y»**, если WhatsApp на номере существует, или значение **«N»**, если WhatsApp на номере не существует.

![](<../../.gitbook/assets/image (1014).png>)

После проведения данных манипуляций, значение сохранённое в поле **«Номер существует?»** можно использовать в качестве условия для определения способа отправки сообщения: через WhatsApp или с помощью SMS.

Выполним дальнейшую настройку роботов. Добавьте робота **«\[OLChat] WhatsApp - Отправка сообщения».** Порядок добавления идентичен описанному выше.

1. Выполните настройку условия: в выпадающем списке выберите пользовательское поле **«Номер существует?»**, установите условие **«равно»** и в поле ниже введите значение **«Y».**
2. Укажите **Линию WhatsApp**, через которую планируете сделать отправку
3. Введите **Номер телефона**, на который необходимо отправить сообщение
4. Ведите текст **Сообщения**
5. Нажмите на кнопку «СОХРАНИТЬ»

![](<../../.gitbook/assets/image (806).png>)

Робот **«\[OLChat] WhatsApp - Отправка файла»** настраивается аналогично, в качестве условия каким способом отправить сообщение выбирается поле, в котором содержится результат проверки

![](<../../.gitbook/assets/image (221).png>)

Последним этапом выполним настройку робота **«Отправить SMS клиенту».**

1. Установите галочку **«после предыдущего робота»**.
2. Выполните настройку условия: в выпадающем списке выберите пользовательское поле **«Номер существует?»**, установите условие **«равно»** и в поле ниже введите значение **«N».**

![](<../../.gitbook/assets/image (870).png>)

3\. Ведите **Текст сообщения**\
4\. Выберите **Тип номера клиента**\
5\. Укажите провайдера, через которого необходимо выполнить отправку\
6\. Нажмите на кнопку «СОХРАНИТЬ»

Таким образом, единоразово сохранив результат проверки робота в пользовательское поле в лиде, вы можете использовать его в последующих стадиях для выбора способа отправки сообщений, избежать дублирования роботов и ускорить их работу в целом.

<figure><img src="../../.gitbook/assets/image (240).png" alt=""><figcaption></figcaption></figure>
