# Calltouch

### Настройка бота-помощника <a href="#nastroika-bota-pomoshnika" id="nastroika-bota-pomoshnika"></a>

В [Настройках коннектора](https://docs.olchat.io/ustanovka-i-nastroika/interfeisy-prilozheniya/opisanie-nastroek-konnektora) есть функционал бота-помощника, который с помощью настройки "Привязать параметр аналитики к полю CRM" позволяет передавать параметры аналитики Roistat, ClientID, UserID и т.д. в любое строковое пользовательское поле.

Для начала необходимо установить бот-помощник на линию.

<figure><img src="../../.gitbook/assets/image (1348).png" alt=""><figcaption></figcaption></figure>

Затем необходимо выбрать поле для настройки "Привязать параметр аналитики к полю CRM".

Для этого необходимо создать поле заранее и в выпадающем списке выбрать то поле лида, в которое необходимо записывать параметры аналитики.

Данная настройка будет работать только в том случае, если выбрано автоматическое создание лидов или сделок в настройках линии.

{% hint style="info" %}
Выбор поля «Привязать параметр аналитики к полю CRM» может быть недоступен, если выбрано ручное создание сущности из чата в разделе Очереди в настройках Открытой линии.
{% endhint %}

### Настройка виджета

1. Зайдите в настройки коннектора
2. В разделе «Настройка виджета на сайт» добавьте параметр **{visit\_id}** в текст приветственного сообщения

<figure><img src="../../.gitbook/assets/image (1354).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Обратите внимание, что если клиент удалит параметр **{visit\_id}** из первого отправляемого сообщения, данные аналитики вы получить не сможете!

Для того, чтобы клиент был заинтересован в отправке сообщения с параметром **{visit\_id}**, вы можете проявить креативность и как-то модифицировать текст сообщения. Например, таким образом: «Здравствуйте! Мой код для получения подарка: **{visit\_id}**»
{% endhint %}

{% hint style="info" %}
При передаче параметров аналитики, бот не ищет цифры по всем тексту - бот вытягивает цифры, которые подставились в {visit id} и записывает в поле.&#x20;

В тексте приветствия не должно быть переносов сроки. Также лучше, чтобы {visit id} находился в конце текста. В ином случае бот не сможет распознать параметр аналитики и записать в поле CRM.
{% endhint %}

### Настройка сайта

Модифицируйте на сайте код следующим образом:

```javascript
<script>

	const b24w = setInterval(() => {
        const l = document.querySelector('[data-b24-crm-button-widget=openline_olchat_wa_connector_2]');
        if (l !== null) {
            const sessionId = window.ct('calltracking_params', 'mod_id')[0].sessionId;
            if (sessionId) {
                clearInterval(b24w);
                l.href = l.href.replace(/\{visit_id\}/, sessionId);
            }
        }
    }, 250);

/* КОД ВИДЖЕТА БИТРИКС24 */

/* КОД АНАЛИТИКИ CALLTOUCH */

</script>
```
